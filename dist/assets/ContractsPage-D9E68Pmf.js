import{j as t,Y as e,T as a,L as r,y as n,ab as s,ac as i,b9 as o,aa as c,ai as l,am as d,r as x,aK as m,w as h,a5 as j,I as u,aS as y,ba as p,aW as g,aX as b}from"./mui-vendor-Cj1s4jkd.js";import{a as f}from"./react-vendor-YkhZaqhD.js";import{c as v,A as C}from"./AddContractDialog-CZWoii4a.js";import{b as w}from"./date-vendor-Bw6RkLa7.js";import{l as k}from"./index-DpeY9hAQ.js";import"./DocumentUpload-DJj0HOi9.js";import"./SignatureCanvas-DkIkFKdv.js";import"./vehicleService-BscnggLA.js";import"./axiosConfig-kM0HH6AN.js";import"./pdf-vendor-BRWHJlHR.js";import"./index-B7rz5ZSC.js";import"./redux-vendor-MKZRiqK7.js";const D=({items:l,onItemClick:d,emptyMessage:x="Aucun élément à afficher"})=>(null==l?void 0:l.length)?t.jsx(r,{sx:{width:"100%",bgcolor:"background.paper",borderRadius:2,overflow:"hidden"},children:l.map((r,x)=>t.jsxs(e,{children:[t.jsxs(n,{button:!!d,onClick:()=>null==d?void 0:d(r),sx:{py:2,"&:active":{backgroundColor:"action.selected"},pr:r.actions?8:2},children:[r.icon&&t.jsx(s,{sx:{minWidth:40},children:r.icon}),t.jsx(i,{primary:t.jsx(a,{variant:"subtitle1",fontWeight:500,children:r.primary}),secondary:t.jsxs(t.Fragment,{children:[Array.isArray(r.secondaryContent)?r.secondaryContent.map((e,r)=>t.jsx(a,{variant:"body2",color:"text.secondary",sx:{display:"block",mb:.5},children:e},r)):r.secondaryContent,r.status&&t.jsx(e,{sx:{display:"inline-block",px:1,py:.5,borderRadius:1,bgcolor:`${r.status.color}15`,color:r.status.color,mt:1},children:t.jsx(a,{variant:"caption",children:r.status.label})})]})}),r.actions&&t.jsx(o,{children:r.actions})]}),x<l.length-1&&t.jsx(c,{})]},r.id||x))}):t.jsx(e,{sx:{py:4,textAlign:"center",color:"text.secondary"},children:t.jsx(a,{variant:"body1",children:x})}),S=({contractId:r,onClose:n})=>{const[s,i]=f.useState(null),[o,j]=f.useState(!0),[u,y]=f.useState(null);return f.useEffect(()=>{r&&(async()=>{try{j(!0);const t=await v.getContractById(r);i(t)}catch(t){y("Impossible de charger les détails du contrat")}finally{j(!1)}})()},[r]),o?t.jsx(l,{}):u?t.jsx(d,{severity:"error",children:u}):s?t.jsxs(x,{sx:{p:3,maxWidth:"100%"},children:[t.jsxs(e,{sx:{mb:3},children:[t.jsx(a,{variant:"h5",gutterBottom:!0,children:"Détails du Contrat"}),t.jsxs(a,{color:"textSecondary",children:["Référence: ",s.contractNumber]})]}),t.jsxs(m,{container:!0,spacing:3,children:[t.jsxs(m,{item:!0,xs:12,children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:"Véhicule"}),t.jsxs(a,{children:[s.vehicle.brand," ",s.vehicle.model]}),t.jsxs(a,{color:"textSecondary",children:["Immatriculation: ",s.vehicle.licensePlate]})]}),t.jsx(m,{item:!0,xs:12,children:t.jsx(c,{})}),t.jsxs(m,{item:!0,xs:12,children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:"Locataire"}),t.jsx(a,{children:s.renter.firstName+" "+s.renter.lastName}),t.jsx(a,{children:s.renter.email}),t.jsx(a,{children:s.renter.phone})]}),t.jsx(m,{item:!0,xs:12,children:t.jsx(c,{})}),t.jsxs(m,{item:!0,xs:12,sm:6,children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:"Période de location"}),t.jsxs(a,{children:["Du: ",w(new Date(s.startDate),"dd MMMM yyyy",{locale:k})]}),t.jsxs(a,{children:["Au: ",w(new Date(s.endDate),"dd MMMM yyyy",{locale:k})]})]}),t.jsxs(m,{item:!0,xs:12,sm:6,children:[t.jsx(a,{variant:"h6",gutterBottom:!0,children:"Tarification"}),t.jsxs(a,{children:["Montant total: ",s.rental.totalAmount.toLocaleString("fr-FR")," €"]}),t.jsxs(a,{color:"textSecondary",children:["Caution: ",s.deposit.toLocaleString("fr-FR")," €"]})]}),t.jsx(m,{item:!0,xs:12,sx:{mt:2},children:t.jsxs(e,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[t.jsx(h,{variant:"outlined",onClick:()=>window.open(`https://locoto-backend.onrender.com/contracts/${r}/pdf`,"_blank"),children:"Télécharger le contrat"}),t.jsx(h,{variant:"contained",onClick:n,children:"Fermer"})]})})]})]}):t.jsx(d,{severity:"info",children:"Aucun contrat sélectionné"})},M=t=>{switch(t){case"À venir":return"#2196F3";case"En cours":return"#4CAF50";default:return"#9E9E9E"}},I=()=>{const[r,n]=f.useState([]),[s,i]=f.useState(null),[o,c]=f.useState(!1),[x,m]=f.useState(!0),[h,k]=f.useState(null),I=async()=>{try{m(!0),k(null);const t=await v.getContracts();n(t)}catch(t){k("Impossible de charger les contrats")}finally{m(!1)}};f.useEffect(()=>{I()},[]);const A=()=>{i(null),k(null)},$=t=>{const e=new Date,a=new Date(t.rental.startDate);return e>new Date(t.rental.endDate)?"Terminé":e<a?"À venir":"En cours"};return x?t.jsx(e,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:t.jsx(l,{})}):s?t.jsx(S,{contract:s,onBack:A}):t.jsxs(e,{sx:{px:2,pb:8},children:[t.jsx(a,{variant:"h5",sx:{my:3,fontWeight:600},children:"Contrats de location"}),h&&t.jsx(d,{severity:"error",sx:{mb:2},children:h}),t.jsx(D,{items:r.map(a=>({id:a.id,primary:`${a.vehicle.brand} ${a.vehicle.model}`,secondaryContent:[`${a.renter.firstName} ${a.renter.lastName}`,`Kilométrage initial: ${a.rental.initialMileage} km • Kilométrage autorisé: ${a.rental.allowedMileage} km`,`${w(new Date(a.rental.startDate),"dd/MM/yyyy")} - ${w(new Date(a.rental.endDate),"dd/MM/yyyy")} • ${a.rental.totalAmount.toLocaleString("fr-FR")} CHF`],status:{label:$(a),color:M($(a))},icon:t.jsx(j,{}),actions:t.jsxs(e,{sx:{display:"flex",gap:1},children:[t.jsx(u,{onClick:t=>{t.stopPropagation(),(async t=>{try{await v.deleteContract(t),await I()}catch(e){k("Impossible de supprimer le contrat")}})(a.id)},size:"small",color:"error",children:t.jsx(y,{})}),t.jsx(u,{onClick:t=>{t.stopPropagation(),(async t=>{try{const e=await v.getPDFContract(t);window.open(e,"_blank")}catch(e){k("Impossible d'ouvrir le PDF du contrat")}})(a.id)},size:"small",color:"primary",children:t.jsx(p,{})})]})})),onItemClick:async t=>{try{const e=await v.getContractById(t.id);i(e)}catch(e){k("Impossible de charger les détails du contrat")}},emptyMessage:"Aucun contrat de location"}),t.jsx(g,{color:"primary","aria-label":"Ajouter un contrat",onClick:()=>c(!0),sx:{position:"fixed",bottom:80,right:16},children:t.jsx(b,{})}),t.jsx(C,{open:o,onClose:()=>c(!1),onSubmit:async t=>{try{await v.createContract(t);await I(),c(!1)}catch(e){k("Impossible de créer le contrat")}}})]})};export{I as default};
